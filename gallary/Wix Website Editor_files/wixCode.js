define("wixCode/utils/wixCodeRemoteModelService",["lodash","RemoteModelInterface"],function(a,b){"use strict";var c=function(c,d,e){var f=new b(void 0,e);return a.forEach(d,function(a){f.addComponent(a,{compName:c.getCompName(a),type:c.getCompType(a),state:c.getCompState(a),data:c.getCompData(a),props:c.getCompProps(a),layout:c.getCompLayout(a),events:c.getActionsAndBehaviors(a)})},this),f},d=function(a,c){return new b(a,c)};return{generateRemoteModelInterface:c,createRemoteModelInterface:d}}),define("wixCode/widgets/RemoteWidgetHandlerProxy",["lodash","wixCode/utils/wixCodeRemoteModelService"],function(a,b){"use strict";function d(){for(;!a.isEmpty(this._messageQueue);){var b=this._messageQueue.shift();this._postMessageDelegate(this._wixCodeWidget,b)}this.hasQueuedMessages=!1}function e(a){this._postMessageDelegate&&this._wixCodeWidget.getIframe()?this.hasQueuedMessages?(this._messageQueue.push(a),d.call(this)):this._postMessageDelegate(this._wixCodeWidget,a):(this.hasQueuedMessages=!0,this._messageQueue.push(a))}function f(b,c,d,e){switch(d){case"data":this._siteDAL.setCompData(c,e);break;case"state":this._siteDAL.setCompState(c,e);break;case"props":this._siteDAL.setCompProps(c,e);break;case"events":this._siteDAL.addActionsAndBehaviors(c,e);break;case"layout":this._siteDAL.updateCompLayout(c,e)}a.isFunction(this._onUpdateCallback)&&this._onUpdateCallback()}function g(a,b,c){this._siteDAL=a,this._wixCodeWidget=b,this._postMessageDelegate=null,this._remoteModelInterfaces={},this._messageQueue=[],this._onUpdateCallback=c}var c={State:"stateChanged",Data:"dataChanged",Props:"propsChanged",Event:"registerEvent",Layout:"layoutChanged"};return g.prototype.registerPostMessageDelegate=function(a){this._postMessageDelegate=a,d.call(this)},g.prototype.initWidgets=function(a,c,d){this.remoteModelInterface=b.generateRemoteModelInterface(this._siteDAL,c,f.bind(this));var e={intent:"WIX_CODE",type:"init_widgets",pageId:a,rmiArguments:{widgetInstanceId:d,widgetData:this.remoteModelInterface.toJson()}};this._sendOrQueueMessage(e)},g.prototype.stopWidget=function(a){var b={intent:"WIX_CODE",type:"terminate",widgetInstanceId:a};this._sendOrQueueMessage(b)},g.prototype.updateComponent=function(a){this._postMessageDelegate&&this._sendOrQueueMessage(a)},g.prototype.onCommand=function(a){switch(a.command){case c.State:this.remoteModelInterface.setState(a.compName,a.data);break;case c.Data:this.remoteModelInterface.setData(a.compName,a.data);break;case c.Layout:this.remoteModelInterface.setLayout(a.compName,a.data);break;case c.Props:this.remoteModelInterface.setProps(a.compName,a.data);break;case c.Event:this.remoteModelInterface.registerEvent(a.widgetInstanceId,a.compName,a.data.action.name,a.data.behavior.params.callbackId)}},g.prototype.handleEvent=function(a,b,c){var d;switch(b){case"runCode":d={intent:"WIX_CODE",type:"wix_code_run_user_function",widgetInstanceId:a,callbackId:c.callbackId,compName:c.compName}}this._sendOrQueueMessage(d)},g.prototype._sendOrQueueMessage=e,g}),define("wixCode/utils/wixCodeClientSpecMapService",["lodash"],function(a){"use strict";var b=function(b){return a.find(b,{type:"siteextension"})},c=function(a){return!!b(a)},d=function(a){return"wixCodeWidget_"+b(a).applicationId},e=function(a){return"wixCodeDataProvider_"+b(a).applicationId};return{getHandlerId:e,getWidgetInstanceId:d,hasWixCodeWidgetSpecs:c,getWixCodeSpec:b}}),define("wixCode/components/wixCodeWidget",["lodash","reactDOM","skins","core","wixCode/widgets/RemoteWidgetHandlerProxy","wixCode/utils/wixCodeClientSpecMapService","tpa","utils"],function(a,b,c,d,e,f,g,h){"use strict";function m(b,c){var d=a.get(c,["currentUrl","query",i]);if(!n(d))return b;var e=b.lastIndexOf("/"),f=b.substring(e+1);return b.replace(f,d)}function n(a){return/^\d+\.\d+\.\d+$/.test(a)}var i="WixCodeRuntimeSource",j=d.compRegistrar,k=d.compMixins,l=function(a){var b=a.wixCloudBaseDomain;return b&&"/"!==b.substr(-1)&&(b+="/"),b},o={mixins:[k.skinBasedComp,g.tpaMixins.tpaCompApi,g.tpaMixins.tpaUrlBuilder],getSkinProperties:function(){var b,a=this.buildUrl(this.getBaseUrl());return b=this.shouldClientSpecMapBeReloaded()?this.isClientSpecMapReloaded()?this._getSkinPropsWithIframe(a):{"":{},iframe:{}}:this._getSkinPropsWithIframe(a)},_getSkinPropsWithIframe:function(a){return{"":{},iframe:{src:a,key:a}}},componentWillMount:function(){var a=this.props.siteAPI.getDAL(),b=this.props.siteAPI.getSiteAspect("wixCodeWidgetAspect"),c=this.props.siteAPI.getSiteAspect("WidgetAspect"),d=this.props.siteAPI.getSiteData().getClientSpecMap(),g=f.getHandlerId(d),h=f.getWidgetInstanceId(d),i=new e(a,this,function(){b.updateSite()});c.registerWidgetHandler(g,i),c.registerWidgetInstance(h,g)},getSantaPath:function(a){function d(a){return a.indexOf("localhost")>=0}var b=a.serviceTopology,c=d(a.santaBase)?b.scriptsLocationMap.santa:a.santaBase;return c=m(c,a),c.replace(b.scriptsDomainUrl,"")},getBaseUrl:function(){var a=this.getAppData(),b=a.extensionId,c=this.props.siteData.serviceTopology,d="//"+b+".",e=l(c),f=this.props.siteData.isDebugMode()?"index.debug.html":"index.html",g="static/wixcode/target/"+f,i=this.getSantaPath(this.props.siteData);return d+h.urlUtils.joinURL(e,"_static",i,g)},mutateIframeUrlQueryParam:function(){function a(){if(void 0!==this.codeVersion)return this.codeVersion;var a=this.getAppData(),b=a.applicationId;return this.props.siteData.rendererModel.cloudVersions[b]}return{codeVersion:a.call(this)}}};return j.register("wysiwyg.viewer.classes.wixCode.WixCodeWidget",o),o}),define("wixCode/utils/wixCodeWidgetCollector",["lodash","utils","wixCode/utils/wixCodeClientSpecMapService"],function(a,b,c){"use strict";function f(c,d){var f=d.getPageData(c).structure,g=b.dataUtils.getAllCompsInStructure(f,d.isMobileView());return a(g).map("id").difference(e.concat(c)).value()}function g(a,b){var e=d.MASTER_PAGE_ID,g=a.getSiteData(),h=g.getClientSpecMap();if(c.hasWixCodeWidgetSpecs(h)){var i=f(b,g),j=f(e,g),k=a.getSiteAspect("WidgetAspect"),l=c.getWidgetInstanceId(h),m=c.getHandlerId(h);k.updateWidgetComponents(l,m,b,i),k.updateWidgetComponents(l,m,e,j)}}var d=b.siteConstants,e=[d.HEADER_ID,d.FOOTER_ID,d.PAGES_CONTAINER_ID,d.SITE_PAGES_ID],h={collectComponents:g};return h}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash","core"],function(a,b){"use strict";function e(a){this._aspectSiteAPI=a}var c=function(a){return{componentType:"wysiwyg.viewer.classes.wixCode.WixCodeWidget",skin:"wysiwyg.viewer.skins.WixCodeWidgetSkin",type:"Component",id:a}},d=function(a,d,e){var f="wixCode_"+e.extensionId,g=c(f),h=b.componentPropsBuilder.getCompProps(g,a,null,d);return h.compData=e,b.compFactory.getCompClass(g.componentType)(h)};return e.prototype={getComponentStructures:function(){var b=this._aspectSiteAPI.getSiteData().getClientSpecMap(),d=this._getWixCodeWidgetsSpecs(b);return a.map(d,c)},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this._aspectSiteAPI.getSiteAPI(),f=this._getWixCodeWidgetsSpecs(c);return a.map(f,a.partial(d,e,b))},_getWixCodeWidgetsSpecs:function(b){return a.filter(b,"type","siteextension")},updateSite:function(){this._aspectSiteAPI.forceUpdate()}},e}),define("wixCode/aspects/WixCodePostMessageAspect",["lodash","wixCode/utils/wixCodeClientSpecMapService"],function(a,b){"use strict";var c={"WIXֹֹֹ_CODE_MESSAGE":"WIX_CODE"},d={IFRAME_READY:"wix_code_iframe_loaded",IFRAME_COMMAND:"wix_code_iframe_command"},e=function(a){return a===c.WIXֹֹֹ_CODE_MESSAGE},f=function(a,c){var d=b.getHandlerId(c);return a.getWidgetHandler(d)},g=function(a,c){var e=this.getWidgetAspect(),g=this.siteAspectsSiteAPI.getSiteData(),h=g.getClientSpecMap(),i=f(e,h);switch(a.type){case d.IFRAME_READY:if(g.isViewerMode()){var j=b.getWidgetInstanceId(h),k=c.getSiteAPI().getCurrentPageId(),l=e.getWidgetComponents(j,k);i.initWidgets(k,l,j)}i.registerPostMessageDelegate(this.sendPostMessage);break;case d.IFRAME_COMMAND:i.onCommand(a)}},h=function(b,c,d){var f;try{a.isString(c.data)?f=JSON.parse(c.data):a.isObject(c.data)&&(f=c.data)}catch(g){return}f&&e(f.intent)&&d.call(this,f,b)},i=function(a,b,c){a.postMessage||(a=a.contentWindow),a.postMessage(b,c||"*")},j=function(a){a.registerToMessage(this.handleMessage.bind(this)),this.siteAspectsSiteAPI=a};return j.prototype={handleMessage:function(a,b){h.call(this,this.siteAspectsSiteAPI,a,b||g)},sendPostMessage:function(a,b){var c=a.getIframe();if(!c)throw new Error("No iframe found in wixCode component",a);i(c,b)},getWidgetAspect:function(){return this.siteAspectsSiteAPI.getSiteAPI().getSiteAspect("WidgetAspect")},getWidgetHandler:f},j}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b),d.registerSiteAspect("wixCodePostMessageAspect",c)}),define("wixCode/utils/kibanaReporter",["lodash","utils"],function(b,c){"use strict";function e(a,d){var e=b.clone(a);e=f(e);var g={protocol:"http:",hostname:"monitoringhub."+d,path:"/logstash/events/gost",query:e,hash:""},h=c.urlUtils.buildFullUrl(g),i=new window.Image(0,0);i.src=h}function f(a){var c=b.clone(a);c.message instanceof Error&&(c.message=c.message.stack),c.hasOwnProperty("message")&&!b.isString(c.message)&&(c.message=JSON.stringify(c.message));var d={message:512};return b.forEach(d,function(d,e){b.isString(a[e])&&(c[e]=c[e].substr(0,Math.min(c[e].length,d)))}),c}function g(){return{source:"wix-code-client",level:d.INFO,userActionId:c.guidUtils.getGUID()}}function h(a){if(!b.isString(a)||0===a.length)throw new Error("parameter `baseDomain` is invalid, received: "+a)}function i(a,c){h(c);var d=new Date,f=d.getTime(),i=b.assign({},g(),a,{timestamp:d.toJSON(),actionPosition:"start"});return e(i,c),function(a){var d=new Date,g=d.getTime(),h=(g-f)/1e3;a=b.assign({},i,a,{timestamp:d.toJSON(),duration:h,actionPosition:"end"}),e(a,c)}}var d={INFO:"info",ERROR:"error"};return{levels:d,trace:i}}),define("wixCode",["core","wixCode/components/wixCodeWidget","wixCode/utils/wixCodeWidgetCollector","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/wixCodeClientSpecMapService","wixCode/utils/wixCodeRemoteModelService","wixCode/utils/kibanaReporter"],function(a,b,c,d,e,f,g){"use strict";return a.widgetCollectorRegistry.registerWidgetCollector(c),{wixCodeRemoteModelService:f,wixCodeWidget:b,wixCodeClientSpecMapService:e,log:g}});